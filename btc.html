<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Market Bias Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 16px;
      background: #0b1220;
      color: #e5e7eb;
    }
    h1 {
      text-align: center;
      margin: 8px 0 4px;
      font-size: 1.4rem;
    }
    .subtitle {
      text-align: center;
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 16px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto 32px;
    }
    .card {
      background: #020617;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 14px;
      border: 1px solid #1f2937;
    }
    .card h2 {
      margin: 0 0 6px;
      font-size: 1.05rem;
    }
    .card p.desc {
      margin: 0 0 10px;
      font-size: 0.85rem;
      color: #9ca3af;
    }
    label {
      display: block;
      font-size: 0.85rem;
      margin-top: 8px;
      margin-bottom: 2px;
    }
    input, select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #334155;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
      outline: none;
    }
    input:focus, select:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px rgba(59,130,246,0.5);
    }
    small {
      font-size: 0.75rem;
      color: #9ca3af;
    }
    button {
      width: 100%;
      margin-top: 12px;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      background: #3b82f6;
      color: #fff;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
    }
    button:hover {
      filter: brightness(1.05);
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .row > div {
      flex: 1 1 180px;
    }
    .result-box {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #020617;
      font-size: 0.9rem;
    }
    .score-line {
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .pill {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
    }
    .pill-bull { background: rgba(34,197,94,0.15); color: #4ade80; }
    .pill-bear { background: rgba(248,113,113,0.15); color: #fca5a5; }
    .pill-neutral { background: rgba(148,163,184,0.25); color: #e5e7eb; }
    .light {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
    }
    .light-green { background: #22c55e; }
    .light-yellow { background: #eab308; }
    .light-red { background: #ef4444; }
    .list {
      font-size: 0.85rem;
      color: #e5e7eb;
    }
    .list li {
      margin-bottom: 4px;
    }
    .disclaimer {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-top: 6px;
    }
    .links button {
      width: auto;
      margin-top: 4px;
      margin-right: 4px;
      padding: 6px 10px;
      font-size: 0.8rem;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #374151;
      color: #9ca3af;
    }
    .links button:hover {
      border-color: #3b82f6;
      color: #e5e7eb;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>AI Market Bias Dashboard</h1>
    <div class="subtitle">
      手工输入 4 个数字 → 多空倾向立即显示（帮助你做决策，而不是替你下单）
    </div>

    <!-- A. 数据来源按钮 -->
    <section class="card">
      <h2>A. 快速打开数据网站</h2>
      <p class="desc">每天打开这些网站 → 抄数字到下面输入区。</p>
      <div class="links">
        <button onclick="openLink('https://www.coinglass.com/FundingRate')">Coinglass Funding Rate</button>
        <button onclick="openLink('https://www.tradingview.com/chart/?symbol=BINANCE:BTCUSDT')">BTC Chart (Trend)</button>
        <button onclick="openLink('https://www.tradingview.com/chart/?symbol=BINANCE:ETHUSDT')">ETH Chart (Trend)</button>
        <button onclick="openLink('https://coinmarketcap.com/charts/')">BTC Dominance</button>
        <button onclick="openLink('https://www.binance.com/en/price/bitcoin')">BTC Volume</button>
        <button onclick="openLink('https://www.binance.com/en/price/ethereum')">ETH Volume</button>
      </div>
    </section>

    <!-- B. 输入区 -->
    <section class="card">
      <h2>B. 输入今日市场数据</h2>

      <label>Asset（标的）</label>
      <select id="asset">
        <option value="BTC">BTC</option>
        <option value="ETH">ETH</option>
      </select>

      <div class="row">
        <div>
          <label>1. 今日价格涨跌（%）</label>
          <input id="priceChange" type="number" step="0.01" placeholder="如 +1.2 或 -0.8">
        </div>

        <div>
          <label>2. Funding Rate（%）</label>
          <input id="funding" type="number" step="0.0001" placeholder="如 0.0074 或 -0.013">
        </div>
      </div>

      <div class="row">
        <div>
          <label>3. 成交量变化（%）</label>
          <input id="volChange" type="number" step="1" placeholder="如 +20 或 -15">
        </div>

        <div>
          <label>4. BTC Dominance 变化（%）</label>
          <input id="domChange" type="number" step="0.1" placeholder="如 +1.2 或 -0.5">
        </div>
      </div>

      <button onclick="runEvaluation()">Evaluate（评估趋势倾向）</button>

      <div id="result" class="result-box">
        输入数据后点击 Evaluate。
      </div>
    </section>
  </div>

<script>
function openLink(url) {
  window.open(url, "_blank");
}

// ---------------------------
// 修复后的主函数（可运行）
// ---------------------------
function runEvaluation() {
  const asset = document.getElementById("asset").value;
  const priceChange = Number(document.getElementById("priceChange").value || 0);
  const funding = Number(document.getElementById("funding").value || 0);
  const volChange = Number(document.getElementById("volChange").value || 0);
  const domChange = Number(document.getElementById("domChange").value || 0);

  let score = 0;
  const reasonsBull = [];
  const reasonsBear = [];

  // --- 1. 价格趋势 ---
  if (priceChange >= 1) {
    score += 3;
    reasonsBull.push(`价格上涨 ${priceChange}%，属于<strong>强上涨</strong>。`);
  } else if (priceChange >= 0.5) {
    score += 2;
    reasonsBull.push(`价格上涨 ${priceChange}%，属于中等上涨。`);
  } else if (priceChange > 0) {
    score += 1;
    reasonsBull.push(`价格小幅上涨 ${priceChange}%。`);
  } else if (priceChange <= -1) {
    score -= 3;
    reasonsBear.push(`价格下跌 ${priceChange}%，属于<strong>强下跌</strong>。`);
  } else if (priceChange <= -0.5) {
    score -= 2;
    reasonsBear.push(`价格下跌 ${priceChange}%，为中等下跌。`);
  } else if (priceChange < 0) {
    score -= 1;
    reasonsBear.push(`价格小幅下跌 ${priceChange}%。`);
  }

  // --- 2. Funding Rate ---
  if (funding > 0.02) {
    score -= 1;
    reasonsBear.push(`Funding ${funding}%，多头过热 → 回调风险。`);
  } else if (funding > 0) {
    score += 1;
    reasonsBull.push(`Funding ${funding}%，多头占优。`);
  } else if (funding < -0.02) {
    score += 1;
    reasonsBull.push(`Funding ${funding}%，空头过热 → 可能反弹。`);
  } else if (funding < 0) {
    score -= 1;
    reasonsBear.push(`Funding ${funding}%，偏空情绪。`);
  }

  // --- 3. 成交量变化 ---
  if (priceChange > 0 && volChange > 0) {
    score += 1;
    reasonsBull.push(`成交量增加 ${volChange}% → 上涨更可信。`);
  } else if (priceChange > 0 && volChange < 0) {
    score -= 1;
    reasonsBear.push(`上涨但缩量（-${Math.abs(volChange)}%）→ 可能是假涨。`);
  } else if (priceChange < 0 && volChange > 0) {
    score -= 1;
    reasonsBear.push(`下跌放量（+${volChange}%）→ 真实抛压。`);
  } else if (priceChange < 0 && volChange < 0) {
    score += 0.5;
    reasonsBull.push(`下跌缩量 → 空头力度不足。`);
  }

  // --- 4. BTC Dominance ---
  if (domChange !== 0) {
    if (asset === "BTC") {
      if (domChange > 0) {
        score += 1;
        reasonsBull.push(`BTC Dominance 上升 ${domChange} → 资金回流 BTC。`);
      } else {
        score -= 1;
        reasonsBear.push(`BTC Dominance 下降 ${Math.abs(domChange)} → 资金流向山寨。`);
      }
    } else if (asset === "ETH") {
      if (domChange < 0) {
        score += 1;
        reasonsBull.push(`资金更偏向主流山寨，对 ETH 有利。`);
      } else {
        score -= 1;
        reasonsBear.push(`BTC 更强势，ETH 相对承压。`);
      }
    }
  }

  // --- 输出灯号 ---
  let biasText = "";
  let light = "";
  let pill = "";

  if (score >= 6) {
    light = "light-green";
    pill = "pill-bull";
    biasText = "系统强烈偏多（胜率倾向明显偏向 Call）";
  } else if (score >= 2) {
    light = "light-green";
    pill = "pill-bull";
    biasText = "系统偏多（可小仓尝试 Call）";
  } else if (score <= -6) {
    light = "light-red";
    pill = "pill-bear";
    biasText = "系统强烈偏空（Put 胜率高，但注意极端行情反转）";
  } else if (score <= -2) {
    light = "light-red";
    pill = "pill-bear";
    biasText = "系统偏空（可小仓尝试 Put）";
  } else {
    light = "light-yellow";
    pill = "pill-neutral";
    biasText = "中性行情 → 不建议做方向性单";
  }

  // --- 渲染结果 ---
  document.getElementById("result").innerHTML = `
    <div class="score-line">
      <span>资产：<strong>${asset}</strong></span>
      <span>总分：<strong>${score.toFixed(1)}</strong></span>
      <span class="pill ${pill}">
        <span class="light ${light}"></span> &nbsp;${biasText}
      </span>
    </div>

    ${reasonsBull.length ? "<ul class='list'><strong>偏多原因：</strong>" + reasonsBull.map(r => `<li>${r}</li>`).join("") + "</ul>" : ""}
    ${reasonsBear.length ? "<ul class='list'><strong>偏空原因：</strong>" + reasonsBear.map(r => `<li>${r}</li>`).join("") + "</ul>" : ""}
  `;
}
</script>

</body>
</html>
